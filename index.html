<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reflecta | Tables Infini Premium</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            black: '#0a0a0a', dark: '#141414', input: '#1f1f1f',
                            gold: '#D4AF37', goldlight: '#F3E5AB', accent: '#ffffff',
                        }
                    },
                    fontFamily: { serif: ['"Playfair Display"', 'serif'], sans: ['"Inter"', 'sans-serif'] },
                    boxShadow: { 'glow': '0 0 20px rgba(212, 175, 55, 0.15)' }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0a0a0a; color: #f5f5f5; overflow-x: hidden; }
        .fade-in { animation: fadeIn 0.8s cubic-bezier(0.22, 1, 0.36, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .form-input { width: 100%; background-color: #1f1f1f; border: 1px solid #333; padding: 14px; border-radius: 2px; color: white; outline: none; transition: all 0.3s; font-family: 'Inter', sans-serif; }
        .form-input:focus { border-color: #D4AF37; }
        .btn-gold { background: linear-gradient(135deg, #D4AF37 0%, #C5A028 100%); color: black; font-weight: 600; letter-spacing: 0.1em; transition: all 0.4s ease; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .btn-gold:hover { background: linear-gradient(135deg, #F3E5AB 0%, #D4AF37 100%); transform: translateY(-2px); }
        .admin-card { background: #141414; border: 1px solid #333; padding: 15px; border-radius: 4px; margin-bottom: 10px; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; display: flex; align-items: center; justify-content: center; }
        /* Style tableau commandes */
        .order-table { width: 100%; text-align: left; border-collapse: collapse; }
        .order-table th { color: #D4AF37; font-size: 10px; text-transform: uppercase; padding: 10px; border-bottom: 1px solid #333; }
        .order-table td { padding: 12px 10px; font-size: 13px; border-bottom: 1px solid #1a1a1a; color: #ccc; }
        .tab-btn { padding: 10px 20px; color: #666; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: #D4AF37; border-bottom: 2px solid #D4AF37; }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col font-sans">

    <nav class="w-full py-5 px-6 md:px-12 flex justify-between items-center bg-brand-black/95 backdrop-blur-md sticky top-0 z-50 border-b border-white/5">
        <div class="flex items-center gap-3 cursor-pointer group" onclick="app.showHome()">
            <span class="text-2xl font-serif tracking-widest text-white group-hover:text-brand-gold transition-colors">REFLECTA</span>
        </div>
        <div class="hidden md:flex gap-8 text-xs font-semibold tracking-[0.2em] text-gray-400">
            <a href="#" onclick="app.showHome()" class="hover:text-brand-gold transition-colors">COLLECTION</a>
            <a href="#" onclick="adminApp.toggleAdmin()" class="hover:text-red-500 transition-colors opacity-50">ADMIN</a>
        </div>
    </nav>

    <main id="app-container" class="flex-grow relative">
        
        <div id="home-view" class="fade-in">
            <section class="py-24 text-center">
                <h1 class="text-5xl md:text-8xl font-serif text-white uppercase mb-8">REFLECTA <span class="italic text-brand-gold">Luxe</span></h1>
            </section>
            <section class="py-10 px-6 md:px-12 bg-brand-dark min-h-[50vh]">
                <div class="max-w-7xl mx-auto">
                    <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 gap-16">
                        <div class="col-span-full text-center py-20 text-gray-500">Chargement...</div>
                    </div>
                </div>
            </section>
        </div>

        <div id="product-view" class="hidden fade-in min-h-screen bg-brand-dark pb-20">
            <div class="max-w-7xl mx-auto px-6 py-10">
                <button onclick="app.showHome()" class="mb-10 text-xs font-bold text-gray-500 hover:text-white flex gap-2"><i data-lucide="arrow-left" class="w-4 h-4"></i> RETOUR</button>
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
                    <div class="lg:col-span-7">
                        <img id="detail-main-image" src="" class="w-full aspect-square object-cover rounded-sm border border-white/10">
                        <h2 id="detail-title" class="text-3xl text-white mt-8 font-serif"></h2>
                        <p id="detail-desc" class="text-gray-400 mt-4 leading-relaxed"></p>
                    </div>
                    <div class="lg:col-span-5">
                        <div class="bg-brand-black p-8 rounded-sm border border-brand-gold/20 shadow-glow sticky top-24">
                            <h2 class="text-xl font-serif text-white mb-6 text-center">Passer commande</h2>
                            <form id="order-form" onsubmit="app.submitOrder(event)" class="space-y-4">
                                <input type="hidden" id="order-prod-name">
                                <input type="hidden" id="order-prod-price">
                                <input type="text" id="order-nom" required class="form-input" placeholder="Votre Nom">
                                <input type="tel" id="order-tel" required class="form-input" placeholder="Numéro de téléphone">
                                <textarea id="order-addr" required class="form-input h-24 resize-none" placeholder="Adresse de livraison"></textarea>
                                <div class="flex justify-between text-white font-serif py-4 border-t border-white/10 mt-2">
                                    <span>Total</span><span id="order-total" class="text-brand-gold text-xl"></span>
                                </div>
                                <button type="submit" id="btn-submit-order" class="btn-gold w-full py-4 text-sm">CONFIRMER LA COMMANDE</button>
                            </form>
                            <div id="success-msg" class="hidden text-center py-10">
                                <i data-lucide="check-circle" class="w-12 h-12 text-brand-gold mx-auto mb-4"></i>
                                <h3 class="text-white text-xl">Merci !</h3>
                                <p class="text-gray-500 text-sm mt-2">Nous vous appellerons pour confirmer.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="admin-view" class="hidden fade-in min-h-screen bg-[#050505] pt-10 px-6 pb-20">
            <div class="max-w-5xl mx-auto">
                <div class="flex justify-between items-center mb-10 border-b border-white/10 pb-4">
                    <h2 class="text-2xl font-serif text-brand-gold">Administration</h2>
                    <button onclick="adminApp.logout()" class="text-xs text-red-500 hover:text-red-400">Déconnexion</button>
                </div>

                <div id="admin-login" class="max-w-sm mx-auto mt-20">
                    <form onsubmit="adminApp.login(event)" class="space-y-4">
                        <input type="text" id="adm-user" placeholder="User" class="form-input">
                        <input type="password" id="adm-pass" placeholder="Password" class="form-input">
                        <button type="submit" id="btn-login" class="btn-gold w-full py-3">ENTRER</button>
                        <p id="login-err" class="text-red-500 text-xs text-center hidden">Erreur</p>
                    </form>
                </div>

                <div id="admin-dashboard" class="hidden">
                    <div class="flex gap-4 mb-8 border-b border-white/10">
                        <div onclick="adminApp.switchTab('products')" id="tab-products" class="tab-btn active">Produits</div>
                        <div onclick="adminApp.switchTab('orders')" id="tab-orders" class="tab-btn">Commandes</div>
                    </div>

                    <div id="view-products">
                        <button onclick="adminApp.openModal()" class="mb-6 bg-white/10 text-brand-gold px-4 py-2 rounded text-xs font-bold border border-brand-gold/20 flex items-center gap-2">
                            <i data-lucide="plus" class="w-4 h-4"></i> NOUVEAU PRODUIT
                        </button>
                        <div id="admin-list" class="space-y-2"></div>
                    </div>

                    <div id="view-orders" class="hidden">
                        <div class="bg-[#141414] rounded border border-white/10 overflow-hidden">
                            <table class="order-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Client</th>
                                        <th>Tel</th>
                                        <th>Produit</th>
                                        <th>Prix</th>
                                    </tr>
                                </thead>
                                <tbody id="orders-list">
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="prod-modal" class="hidden modal p-4">
            <div class="bg-[#1a1a1a] border border-white/10 w-full max-w-lg p-6 rounded relative">
                <button onclick="adminApp.closeModal()" class="absolute top-4 right-4 text-white"><i data-lucide="x"></i></button>
                <h3 class="text-white font-serif mb-4">Éditer Produit</h3>
                <form onsubmit="adminApp.saveProduct(event)" class="space-y-3">
                    <input type="hidden" id="edit-id">
                    <input type="text" id="edit-title" class="form-input" placeholder="Titre" required>
                    <input type="number" id="edit-price" class="form-input" placeholder="Prix" required>
                    <textarea id="edit-desc" class="form-input h-20" placeholder="Description"></textarea>
                    <input type="text" id="edit-img1" class="form-input" placeholder="Image URL 1" required>
                    <input type="text" id="edit-img2" class="form-input" placeholder="Image URL 2 (Optionnel)">
                    <button type="submit" id="btn-save" class="btn-gold w-full py-3 mt-2">ENREGISTRER</button>
                </form>
            </div>
        </div>

    </main>

    <footer class="bg-black py-6 text-center text-gray-700 text-[10px] uppercase border-t border-white/5">© 2026 Reflecta.</footer>

    <script>
        // --- CONFIGURATION ---
        const API_URL = "VOTRE_URL_GOOGLE_SCRIPT_ICI"; // <--- COLLEZ L'URL ICI !

        let allProducts = [];
        let authToken = localStorage.getItem('adm_tok');

        async function api(data) {
            return fetch(API_URL, { method: "POST", body: JSON.stringify(data) }).then(r => r.json());
        }

        const app = {
            init: function() {
                fetch(API_URL).then(r => r.json()).then(data => {
                    allProducts = data;
                    this.renderGrid();
                }).catch(e => console.error(e));
                lucide.createIcons();
            },
            renderGrid: function() {
                const grid = document.getElementById('products-grid');
                grid.innerHTML = '';
                if(allProducts.length === 0) grid.innerHTML = '<p>Aucun produit.</p>';
                allProducts.forEach(p => {
                    const img = (p.images && p.images[0]) ? p.images[0] : '';
                    grid.innerHTML += `
                    <div onclick="app.showProduct('${p.id}')" class="group bg-brand-black border border-white/5 cursor-pointer hover:border-brand-gold/50 transition-all">
                        <div class="h-80 overflow-hidden relative">
                            <img src="${img}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500">
                        </div>
                        <div class="p-6 text-center">
                            <h3 class="text-white text-xl font-serif">${p.title}</h3>
                            <span class="text-brand-gold">${p.price} DTN</span>
                        </div>
                    </div>`;
                });
            },
            showProduct: function(id) {
                const p = allProducts.find(x => String(x.id) === String(id));
                if(!p) return;
                document.getElementById('detail-title').innerText = p.title;
                document.getElementById('detail-desc').innerText = p.desc;
                document.getElementById('detail-main-image').src = p.images[0] || '';
                document.getElementById('order-prod-name').value = p.title;
                document.getElementById('order-prod-price').value = p.price;
                document.getElementById('order-total').innerText = p.price + " DTN";
                
                document.getElementById('home-view').classList.add('hidden');
                document.getElementById('product-view').classList.remove('hidden');
                window.scrollTo(0,0);
            },
            showHome: function() {
                document.getElementById('product-view').classList.add('hidden');
                document.getElementById('admin-view').classList.add('hidden');
                document.getElementById('home-view').classList.remove('hidden');
                window.scrollTo(0,0);
            },
            submitOrder: function(e) {
                e.preventDefault();
                const btn = document.getElementById('btn-submit-order');
                btn.innerText = "ENVOI EN COURS...";
                
                const data = {
                    action: "order",
                    produit: document.getElementById('order-prod-name').value,
                    prix: document.getElementById('order-prod-price').value,
                    nom: document.getElementById('order-nom').value,
                    tel: document.getElementById('order-tel').value,
                    adresse: document.getElementById('order-addr').value
                };

                api(data).then(res => {
                    if(res.status === "success") {
                        document.getElementById('order-form').classList.add('hidden');
                        document.getElementById('success-msg').classList.remove('hidden');
                    } else {
                        alert("Erreur");
                        btn.innerText = "RÉESSAYER";
                    }
                });
            }
        };

        const adminApp = {
            toggleAdmin: function() {
                document.getElementById('home-view').classList.add('hidden');
                document.getElementById('product-view').classList.add('hidden');
                document.getElementById('admin-view').classList.remove('hidden');
                
                if(authToken === "logged_in_secure_token") {
                    document.getElementById('admin-login').classList.add('hidden');
                    document.getElementById('admin-dashboard').classList.remove('hidden');
                    this.loadProducts();
                } else {
                    document.getElementById('admin-login').classList.remove('hidden');
                }
            },
            login: function(e) {
                e.preventDefault();
                const u = document.getElementById('adm-user').value;
                const p = document.getElementById('adm-pass').value;
                document.getElementById('btn-login').innerText = "...";
                
                api({ action: "login", username: u, password: p }).then(res => {
                    if(res.status === "success") {
                        authToken = res.token;
                        localStorage.setItem('adm_tok', authToken);
                        this.toggleAdmin();
                    } else {
                        document.getElementById('login-err').classList.remove('hidden');
                    }
                    document.getElementById('btn-login').innerText = "ENTRER";
                });
            },
            logout: function() {
                authToken = null;
                localStorage.removeItem('adm_tok');
                app.showHome();
            },
            switchTab: function(tab) {
                if(tab === 'products') {
                    document.getElementById('view-products').classList.remove('hidden');
                    document.getElementById('view-orders').classList.add('hidden');
                    document.getElementById('tab-products').classList.add('active');
                    document.getElementById('tab-orders').classList.remove('active');
                    this.loadProducts();
                } else {
                    document.getElementById('view-products').classList.add('hidden');
                    document.getElementById('view-orders').classList.remove('hidden');
                    document.getElementById('tab-products').classList.remove('active');
                    document.getElementById('tab-orders').classList.add('active');
                    this.loadOrders();
                }
            },
            loadProducts: function() {
                const list = document.getElementById('admin-list');
                list.innerHTML = '';
                allProducts.forEach(p => {
                    list.innerHTML += `
                    <div class="admin-card flex justify-between items-center">
                        <div class="text-white font-serif">${p.title} <span class="text-brand-gold ml-2">${p.price} DTN</span></div>
                        <div class="flex gap-2">
                            <button onclick="adminApp.openModal('${p.id}')" class="text-blue-400 p-2"><i data-lucide="edit"></i></button>
                            <button onclick="adminApp.deleteP('${p.id}')" class="text-red-500 p-2"><i data-lucide="trash"></i></button>
                        </div>
                    </div>`;
                });
                lucide.createIcons();
            },
            loadOrders: function() {
                const tbody = document.getElementById('orders-list');
                tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4">Chargement...</td></tr>';
                
                api({ action: "getOrders", token: authToken }).then(res => {
                    tbody.innerHTML = '';
                    if(!res.orders || res.orders.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4">Aucune commande.</td></tr>';
                        return;
                    }
                    res.orders.forEach(o => {
                        tbody.innerHTML += `
                        <tr>
                            <td>${o[0]}</td>
                            <td class="font-bold text-white">${o[1]}</td>
                            <td>${o[2]}</td>
                            <td>${o[4]}</td>
                            <td class="text-brand-gold">${o[5]}</td>
                        </tr>`;
                    });
                });
            },
            // Fonctions CRUD Produits
            openModal: function(id=null) {
                document.getElementById('prod-modal').classList.remove('hidden');
                document.querySelector('#prod-modal form').reset();
                document.getElementById('edit-id').value = "";
                if(id) {
                    const p = allProducts.find(x => String(x.id) === String(id));
                    document.getElementById('edit-id').value = id;
                    document.getElementById('edit-title').value = p.title;
                    document.getElementById('edit-price').value = p.price;
                    document.getElementById('edit-desc').value = p.desc;
                    document.getElementById('edit-img1').value = p.images[0]||'';
                    document.getElementById('edit-img2').value = p.images[1]||'';
                }
            },
            closeModal: () => document.getElementById('prod-modal').classList.add('hidden'),
            saveProduct: function(e) {
                e.preventDefault();
                const btn = document.getElementById('btn-save');
                btn.innerText = "...";
                const data = {
                    action: "saveProduct", token: authToken,
                    id: document.getElementById('edit-id').value,
                    title: document.getElementById('edit-title').value,
                    price: document.getElementById('edit-price').value,
                    desc: document.getElementById('edit-desc').value,
                    image1: document.getElementById('edit-img1').value,
                    image2: document.getElementById('edit-img2').value
                };
                api(data).then(res => {
                    this.closeModal();
                    app.init(); // Refresh data
                    setTimeout(() => this.loadProducts(), 500);
                    btn.innerText = "ENREGISTRER";
                });
            },
            deleteP: function(id) {
                if(confirm("Supprimer ?")) {
                    api({ action: "deleteProduct", token: authToken, id: id }).then(() => {
                        app.init(); setTimeout(() => this.loadProducts(), 500);
                    });
                }
            }
        };

        app.init();
    </script>
</body>
</html>
